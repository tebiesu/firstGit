# 基于情感识别与视觉分析的个人饮食健康智能助手实现方案

## 1. 项目背景与目标
本项目面向个人饮食健康管理场景，构建一个融合“情绪识别 + 视觉分析 + 大语言模型推理”的智能助手系统。  
系统核心目标是实现“输入少、建议可执行、可持续追踪”的闭环能力：

1. 用户上传餐食图像并输入当前情绪/状态；
2. 系统自动完成食物识别与营养估算；
3. 结合用户情绪状态生成个性化饮食建议；
4. 提供历史追踪、风险提示和趋势报表。

## 2. 建设目标与验收标准
### 2.1 建设目标
- 支持多模型渠道接入：`OpenAI格式`、`Gemini`、`Claude`、`New API`；
- 支持统一模型调用协议和可插拔 Provider；
- 支持个人用户长期饮食与情绪记录；
- 支持管理员配置模型渠道、监控调用质量与日志审计。

### 2.2 验收标准
1. 完成用户注册登录、画像维护、餐食分析全流程；
2. 可在后台切换不同模型并完成健康检查；
3. 单次分析可返回结构化结果（情绪、营养、建议、风险）；
4. 可查看日报/周报趋势图；
5. 具备基础隐私保护（敏感信息加密、脱敏、审计）。

## 3. 总体架构设计
### 3.1 技术栈
- 前端：Vue3 + Vite + Element Plus + Pinia + ECharts
- 后端：Python FastAPI + SQLAlchemy + Alembic + Pydantic v2
- 数据：PostgreSQL（主库）+ Redis（缓存/队列）+ MinIO（图片存储）
- 部署：Docker Compose（云服务器）
- 鉴权：JWT + RBAC（user/admin）

### 3.2 系统分层
1. Web 前端层（用户端/管理端）
2. API 网关层（鉴权、参数校验、路由）
3. 业务服务层（情绪识别、视觉营养分析、建议生成、追踪统计）
4. 模型适配层（统一 Provider 接口）
5. 数据存储层（PostgreSQL/Redis/MinIO）

## 4. 关键功能模块设计
### 4.1 情绪识别模块
输入：
- 用户文本描述（如“今天心情不好，想吃甜食”）
- 可选简短问卷分值（压力、饥饿、睡眠）

输出：
- 情绪标签（平稳/焦虑/低落/压力高）
- 风险评分（暴食冲动风险、饮食失衡风险）

### 4.2 视觉营养分析模块
输入：
- 餐食图像（1~3张）

输出：
- 食物项识别结果（名称、置信度）
- 份量估算（粗粒度）
- 营养估算（热量、蛋白质、脂肪、碳水）

### 4.3 个性化建议模块
融合输入：
- 情绪状态 + 营养估算 + 用户画像（目标/过敏/禁忌）

输出：
- 本餐建议（适量/替代食物）
- 下一餐建议（补偿而非极端节食）
- 行为建议（喝水、慢食、延迟冲动决策）

### 4.4 追踪与报告模块
- 日报：摄入、情绪、建议执行情况
- 周报：趋势图、达标率、风险变化
- 提醒：连续高风险情绪触发告警建议

## 5. 多模型接入设计（核心）
### 5.1 统一 Provider 接口
定义统一抽象接口（示意）：
- `chat(messages, model, params)`
- `vision(messages, images, model, params)`
- `health_check()`

### 5.2 Provider 列表
- OpenAICompatibleProvider（用于 OpenAI 与 New API）
- GeminiProvider
- ClaudeProvider

### 5.3 渠道配置字段
- `provider_type`：openai_compatible / gemini / claude
- `base_url`：支持自定义渠道地址
- `api_key`：加密存储
- `model_map`：任务到模型映射（emotion/vision/recommend）
- `priority`：路由优先级
- `enabled`：是否启用

### 5.4 路由与降级策略
- 主渠道失败时自动切换备用渠道；
- 任务级模型路由：
  - 情绪分类：轻量模型优先；
  - 视觉分析：多模态模型优先；
  - 建议生成：高质量文本模型优先。

## 6. 数据库设计（推荐 PostgreSQL）
### 6.1 主表
- `users`：用户信息、登录凭证、角色
- `health_profiles`：目标、过敏、禁忌、慢病信息
- `meals`：餐次记录、时间、图片路径
- `meal_analyses`：视觉识别与营养估算结果
- `emotion_records`：情绪识别结果
- `recommendations`：建议内容与执行反馈
- `provider_configs`：模型渠道配置
- `provider_call_logs`：模型调用日志
- `audit_logs`：审计日志

### 6.2 索引建议
- `user_id + created_at`
- `provider_id + created_at`
- `risk_score`
- `meal_time`

## 7. 核心 API 设计
### 7.1 用户端 API
- `POST /api/v1/auth/register`
- `POST /api/v1/auth/login`
- `GET /api/v1/profile`
- `PUT /api/v1/profile`
- `POST /api/v1/meal/analyze`
- `GET /api/v1/meal/history`
- `GET /api/v1/report/daily`
- `GET /api/v1/report/weekly`

### 7.2 管理端 API
- `GET /api/v1/admin/providers`
- `POST /api/v1/admin/providers`
- `PUT /api/v1/admin/providers/{id}`
- `POST /api/v1/admin/providers/{id}/test`
- `GET /api/v1/admin/audit-logs`

## 8. 安全与隐私设计
- API Key 使用服务端密钥加密存储；
- 个人信息展示脱敏；
- 图片采用对象存储签名 URL；
- 关键操作记录审计日志；
- 导出报表支持匿名化。

## 9. 测试方案与场景
### 9.1 单元测试
- Provider 统一接口契约测试；
- 情绪融合评分逻辑测试；
- 权限与鉴权测试；
- 输入参数边界测试。

### 9.2 集成测试
1. 上传图片并完成全链路分析；
2. 主模型故障后自动切换备用模型；
3. 用户画像改变导致建议变化；
4. 高风险情绪输入触发告警建议。

### 9.3 性能目标
- 单次分析接口 P95 < 6 秒（常规图片）；
- 模型故障切换成功率 > 95%。

## 10. 项目里程碑（12周）
1. 第1-2周：需求分析、原型、数据库设计  
2. 第3-4周：鉴权系统与 OpenAI/New API 接入  
3. 第5-6周：Gemini/Claude 接入与统一适配层  
4. 第7-8周：情绪识别与视觉营养分析联调  
5. 第9周：建议引擎、日报周报  
6. 第10周：隐私安全与审计  
7. 第11周：测试、优化、压测  
8. 第12周：论文与答辩演示材料整理

## 11. 风险与应对
- 模型响应不稳定：增加重试、超时、降级路由；
- 图像识别误差：增加人工修正入口；
- 云服务波动：增加缓存与备用渠道；
- 数据隐私风险：最小化存储 + 加密 + 审计。

## 12. 结论
本方案在毕设周期内可落地，兼顾创新性（情感+视觉+LLM融合）与工程完整性（多渠道模型适配、可观测、安全、可部署）。  
通过统一 Provider 设计，系统具备持续扩展能力，后续可平滑新增更多模型平台与个性化健康能力。
